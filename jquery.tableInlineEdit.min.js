!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function s(){!t&&this.construct&&this.construct.apply(this,arguments)}var n=this.prototype;t=!0;var o=new this;t=!1;for(var a in i)o[a]="function"==typeof i[a]&&"function"==typeof n[a]&&e.test(i[a])?function(t,e){return function(){var i=this._super;this._super=n[t];var s=e.apply(this,arguments);return this._super=i,s}}(a,i[a]):i[a];return o.setOption=function(t,e){this[t]=e},s.prototype=o,s.prototype.constructor=s,s.extend=arguments.callee,s}}(),jQuery.fn.extend({inlineEdit:function(t){this.tableInlineEdit=new(InlineTableEdit=Class.extend({defaults:{controls:{addRow:".add-row",editRow:".edit-row",deleteRow:".delete-row",saveRow:".save-row"},serverSide:{saveUrl:"",extraData:{}}},construct:function(t,e){this.$container=t,this.props=$.extend(this.defaults,e),this.table_header=[],this.init()},init:function(){var t=this;this.$container.find(this.props.controls.saveRow).hide(),this.$container.find("th").each(function(){var e=$(this).data("editable"),i=$(this).data("edit-width"),s=$(this).data("default"),n=$(this).data("name"),o=$(this).data("options");t.table_header.push({editable:void 0!=e?e:!1,name:void 0!=n?n:null,width:void 0!=i?i:null,editDefault:void 0!=s?s:null,options:void 0!=o?o:null})}),this.bindEvents()},bindEvents:function(){var t=this;this.$container.on("click",this.props.controls.editRow,function(){var e=$(this).parents("tr");t.toggleEdit(e,!0)}).on("click",this.props.controls.deleteRow,function(){var e=$(this).parents("tr");t.deleteRow(e)}).on("click",this.props.controls.saveRow,function(){var e=$(this).parents("tr");t.toggleEdit(e,!1)}),this.$container.parents("div").find(this.props.controls.addRow).on("click",function(){t.addRow()})},addRow:function(){var t=this.createEmptyRow();this.$container.append(t),this.toggleEdit(t,!0)},createEmptyRow:function(){var t="<tr>",e=this;return $.each(this.table_header,function(){t+="inline-toolbar"==this.name?'<td style="text-align:center">'+e.toolbarHtml()+"</td>":this.editDefault?"<td>"+this.editDefault+"</td>":"<td></td>"}),t+="</tr>",$(t)},toolbarHtml:function(){var t=['<i class="'+this.props.controls.editRow.substring(1)+' fa fa-pencil-square-o" style="cursor:pointer;font-size:18px;" title="Edit"></i>','<i class="'+this.props.controls.saveRow.substring(1)+' fa fa-check" style="cursor:pointer;font-size:18px;" title="Save"></i>','<i class="'+this.props.controls.deleteRow.substring(1)+' fa fa-times-circle" style="cursor:pointer;font-size:18px;" title="Delete"></i>'];return t.join("")},editRow:function(t){var e=this;t.find("td").each(function(t){var i=e.table_header[t];i.editable&&e.createInput($(this),i)})},saveRow:function(t,e){var i=this,s={};if(t.find("td").each(function(t){var e=i.table_header[t];if(console.log(e),e.editable){switch(e.editable){case"text":case"datetime":var n=$(this).find("input").val();s[e.name]=n;break;case"select":var n=$(this).find("select > option:selected").text();s[e.name]=$(this).find("select").val()}$(this).html(n)}}),this.props.serverSide.saveUrl){var n=t.data("id");this.ajaxSave(n,e,s)}},ajaxSave:function(t,e,i){var s={id:t,method:e,data:i};s.data=$.extend(s.data,this.props.serverSide.extraData);return $.post(this.props.serverSide.saveUrl,s)},toggleEdit:function(t,e){e?(t.find(this.props.controls.editRow).hide(),t.find(this.props.controls.deleteRow).hide(),t.find(this.props.controls.saveRow).show(),this.editRow(t)):(t.find(this.props.controls.editRow).show(),t.find(this.props.controls.deleteRow).show(),t.find(this.props.controls.saveRow).hide(),this.saveRow(t,"edit"))},createInput:function(t,e){var i=t.text(),s=null;switch(e.editable){case"text":s=$('<input type="text">').val(i);break;case"datetime":s=$('<input type="text">').val(i),s.datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"});var n=new Date(Date.parse(i.split("-").join("/")));s.datetimepicker("setDate",n);break;case"select":s=$("<select>");var o=e.options;console.log(o),$.each(o,function(){var t=$('<option value="'+this.id+'">').text(this.text);this.text==i&&t.attr("selected",!0),s.append(t)})}e.width&&s.width(e.width),t.html(s)},deleteRow:function(t){if(t.remove(),this.props.serverSide.saveUrl){var e=t.data("id");e&&this.ajaxSave(e,"delete",{})}}}))(this,t)}});
